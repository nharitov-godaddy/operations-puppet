---
# TODO: not required after the whole control plane is on the next network setup
# This is here to force designate to talk to cloudcontrol using the cloud-private link
# for thinks like galera and memcached
profile::openstack::eqiad1::haproxy_nodes:
  - cloudlb1001.private.eqiad.wikimedia.cloud
  - cloudlb1002.private.eqiad.wikimedia.cloud
  - cloudcontrol1006.wikimedia.org
  - cloudcontrol1007.wikimedia.org
profile::openstack::eqiad1::openstack_controllers:
  - cloudcontrol1005.private.eqiad.wikimedia.cloud
profile::openstack::eqiad1::keystone_host: "openstack-next.eqiad1.wikimediacloud.org"
profile::openstack::eqiad1::keystone_api_fqdn: "openstack-next.eqiad1.wikimediacloud.org"

# Add the third host locally so these can talk to each other but clients
#  don't try to use the new dns server yet.
profile::openstack::eqiad1::pdns::hosts:
  - "ns0.openstack.eqiad1.wikimediacloud.org"
  - "ns1.openstack.eqiad1.wikimediacloud.org"

# TODO: remove the '-next' suffix when ready
profile::openstack::base::pdns::query_local_address: ns1.openstack.eqiad1.wikimediacloud.org
profile::openstack::base::pdns::auth::listen_on:
  - 185.15.56.163  # ns1.openstack.eqiad1.wikimediacloud.org
  - 185.15.56.162  # TODO: temporal, ns0.openstack.eqiad1.wikimediacloud.org

profile::bird::advertise_vips:
  # NOTE: this is the per-host address. There is another shared VIP.
  ns1.openstack.eqiad1.wikimediacloud.org:
    ensure: present
    service_type: "pdns auth"
    address: 185.15.56.163
    # NOTE: we always want to advertise this address
    check_cmd: "/bin/sh -c 'true'"
  # TODO: this is here while we re-rack cloudservices1005
  ns0.openstack.eqiad1.wikimediacloud.org:
    ensure: present
    service_type: "pdns auth"
    address: 185.15.56.162
    # NOTE: we always want to advertise this address
    check_cmd: "/bin/sh -c 'true'"

# TODO: this can go into hieradata/role/eqiad/wmcs/openstack/eqiad1/services.yaml
# once all cloudservices hosts are in the same network setup
# before that, cloudservices1006 is the only node in the new network setup
profile::openstack::base::pdns::recursor::bgp_vip: 172.20.255.1

profile::openstack::eqiad1::designate::db_host: "openstack-next.eqiad1.wikimediacloud.org"
