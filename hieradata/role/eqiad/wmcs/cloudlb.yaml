profile::admin::groups:
  - wmcs-roots

prometheus_nodes:
  # Base scraping from main Prometheus servers
  - prometheus1005.eqiad.wmnet
  - prometheus1006.eqiad.wmnet
  # WMCS-specific Prometheus servers for WMCS-specific scrapes
  - cloudmetrics1003.eqiad.wmnet
  - cloudmetrics1004.eqiad.wmnet

# TODO: override here the list of openstack controllers so HAproxy in cloudlb
# can contact the backends using the cloud-private subnet. Once all cloudcontrol servers are
# in the same network setup, this override here can be deleted, because it should be set elsewhere.
profile::openstack::eqiad1::openstack_controllers:
  - cloudcontrol1005.private.eqiad.wikimedia.cloud

# TODO: we can't set this as default because this key also configures
# DNS stuff which needs the .wikimedia.org public IPv4 addresses (for now)
# However cloudservices <-> cloudlb network flows needs to be opened
# for the cloud-private addresses, so that's why this override here.
profile::openstack::eqiad1::designate_hosts:
  - cloudservices1006.private.eqiad.wikimedia.cloud
  - cloudservices1004.wikimedia.org
  - cloudservices1005.wikimedia.org

profile::bird::advertise_vips:
  # TODO: the FQDN needs update (remove the -next)
  openstack-next.eqiad1.wikimediacloud.org:
    ensure: present
    service_type: haproxy
    address: 185.15.56.161
    check_cmd: "/usr/local/lib/nagios/plugins/check_haproxy --check=someup"
